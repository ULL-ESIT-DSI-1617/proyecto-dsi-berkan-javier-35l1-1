<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: game.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: game.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>(function(exports) {
  var lives = 3;
  // TRACKING KEYS
  /**
   * Tracks the current position of the keys
   * @param {Object} codes - Key codes 
   */
  function trackKeys(codes) {
    var pressed = Object.create(null);
    /**
     * Store the current state of the left, right, and up arrow keys
     * @param {} event 
     */
    function handler(event) {
      if (codes.hasOwnProperty(event.keyCode)) {
        var down = event.type == "keydown";
        pressed[codes[event.keyCode]] = down;
        event.preventDefault();
      }
    }
    addEventListener("keydown", handler);
    addEventListener("keyup", handler);
    return pressed;
  }
  /**
   * Wrap requestAnimationFrame
   * @param {} frameFunc 
   */
  function runAnimation(frameFunc) {
    var lastTime = null;

    function frame(time) {
      var stop = false;
      if (lastTime != null) {
        var timeStep = Math.min(time - lastTime, 100) / 1000;
        stop = frameFunc(timeStep) === false;
      }
      lastTime = time;
      if (!stop)
        requestAnimationFrame(frame);
    }
    requestAnimationFrame(frame);
  }
  /**
   * Display the level
   * @param {Object} level - Level object 
   * @param {Class} Display - Display mode 
   * @param {Function} andThen - Given function
   */
  function runLevel(level, Display, andThen) {
    var arrowCodes = {
      37: "left",
      38: "up",
      39: "right"
    };
    var arrows = trackKeys(arrowCodes);
    var display = new Display(document.body, level);
    runAnimation(function(step) {
      level.animate(step, arrows);
      display.drawFrame(step);
      display.showLiveAndScore(lives);
      if (level.isFinished()) {
        display.clear();
        if (level.status == "lost") {
          lives--;
        }
        if (andThen)
          andThen(level.status);
        return false;
      }
    });
  }
  /**
   * Start building the game
   * @param {Vector} plans - Set of levels 
   * @param {Class} Display - Display mode
   */
  function runGame(plans, Display) {
    function startLevel(n) {
      runLevel(new Level(plans[n]), Display, function(status) {
        if (status == "lost") {
          if (lives === 0) {
            n = 0;
            score = 0;
            lives = 3;
            var elem = document.getElementById('canvasgame');
            if (elem) elem.remove();
            var screendiv = document.getElementById('screen');
            var gameover = document.createElement("h1");
            gameover.id = 'gameover'
            var textgameover = document.createTextNode('GAME OVER');
            gameover.appendChild(textgameover);
            var insertcoin = document.createElement("h1");
            insertcoin.id = 'insertcoin'
            var textinsertcoin = document.createTextNode('Insert coin to try again');
            insertcoin.appendChild(textinsertcoin);
            screendiv.appendChild(gameover);
            gameover.appendChild(insertcoin);
            return;
          }
          startLevel(n);
        } else if (n &lt; plans.length - 1)
          startLevel(n + 1);
        else
          var elem = document.getElementById('canvasgame');
          if (elem) elem.remove();
          var screendiv = document.getElementById('screen');
          var gameover = document.createElement("h1");
          gameover.id = 'gameover'
          var textgameover = document.createTextNode('YOU WIN, CONGRATS');
          gameover.appendChild(textgameover);
      });
    }
    startLevel(0);
  }

  exports.runGame = runGame;
})(self);</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="CanvasDisplay.html">CanvasDisplay</a></li><li><a href="Coin.html">Coin</a></li><li><a href="Lava.html">Lava</a></li><li><a href="Player.html">Player</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.3</a> on Mon May 22 2017 01:30:36 GMT+0100 (Hora de verano GMT)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
